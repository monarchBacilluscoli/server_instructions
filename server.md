# 服务器使用说明

*是否更适合使用流程式的说明而非分条的字典式说明*

下为后面命令行或配置文件中出现的符号及其意义

|   命令中的符号  | 意义            |
|---------------|-----------------|
| `{xxx} ` | 代表必要填写的内容 |
| `[xxx]` | 代表可选填写的内容 |
| `~` |linux下当前用户的home路径的简写|
| `${xxx}` |代表vscode配置中某个系统预设变量（原样填写）|

[TOC]

## 远程登录

在服务器上直接操作固然爽快无延迟，但不支持多人&跑来跑去很麻烦。何以解忧，远程桌面。  
大体流程如下：

1. 获取服务器IP及帐号信息
2. 选用某种远程桌面软件（命令行/图形）
3. 输入登录信息，登录并使用

### 局域网

如果你现在身处与服务器同一部交换机之下，可使用局域网进行远程连接。

#### 获取服务器IP

无论使用何种方式进行局域网连接，最开始都需要获取到服务器IP。两种途径：

* 询问别人
* 直接操作服务器：

    1. `ctrl+alt+T` 打开终端

    2. 输入 `ifconfig` 回车

    3. 寻找en开头的项，其中inet即为IP地址，当下是172.24.151.175。

注： `ifconfig` 是Unix-like系统的网络接口配置工具，常用于查看IP等设置。其中前缀en代表ethernet，通常是有线局域网，而wl则代表wireless连接，即WIFI。

#### ssh

ssh提供了命令行下的远程连接，支持多用户多会话，轻量可靠快捷。

##### 基本操作

``` 
ssh {username}@{hostname}
```

`username` ：要登录的用户名， `hostname` ：服务器IP

然后会询问你用户的密码，输入并回车即可登录。

登录后即可视同本机一般进行命令行操作。

##### ssh免密登录

每次都要输入用户名IP密码进行连接非常麻烦，此处提供了免除以上操作的设置方法：

###### win10客户机

1. powershell中创建公钥：  

打开powershell输入：

``` 
ssh-keygen -t rsa -C "{任意名字或使用邮箱，惯例貌似是邮箱}"
```

*一般默认路径下创建的公钥会存在 `C:/Users/{你的用户名}/.ssh/` 下面，文件名为id_rsa.pub.*

2. 查看并复制内容

``` 
clip < ~/.ssh/id_rsa.pub
```

*将公钥的内容读入剪贴板*

3. 在已经连接到服务器的情况下将复制的内容添加至服务器ssh信任列表中：

命令行下：使用如下命令打开该信任列表

``` 
nano ~/.ssh/authorized_keys
```

粘贴到所有内容的最后即可

图形桌面：直接编辑该文档，粘贴至文件最后即可。

###### Linux客户机

1. 生成密钥（如 `~/.ssh/rsa.pub` 已经存在则跳过这步）

``` 
ssh-keygen
```

2. 直接使用该命令将公钥复制到服务器

``` 
ssh-copy-id {用户名}@{服务器IP}
```

#### ssh免帐号及IP登录

在 `~/.ssh` 下创建文件名为 `config` 的文件
修改该文件内容为：

``` 
Host HPWorkStation          
  HostName {服务器IP} 
  Port 22
  User {你的用户名}
```

之后即可使用别名（HPWorkStation）登录，即

``` 
ssh HPWorkStation
```

设置了免密的话也无需输入密码

#### 图形远程桌面

很多情况下命令行并不能满足日常的工作需求，我们需要图形界面的连接。Linux提供了多用户远程桌面的支持。

##### win10自带远程桌面登录

1. 开始-输入“mstsc”即可打开win10自带远程桌面软件。
2. 输入IP地址，点击连接。遇到提示点击确认。
3. 输入帐号密码，登录即可。

##### Linux远程桌面登录

如果用户机是Linux系统，则可以通过Remmina这款软件（Ubuntu自带）进行远程桌面连接。

1. 点击标题栏中的 Add a new connection profile 按钮
2. Server 栏填入服务器IP，Username，Password 填入用户名和密码点击 Connect 即可。

*如果报错your libfreerdp does not support h264，将Color depth改为除默认选项之外的选项即可*

#### 传文件

部分远程桌面软件都支持直接复制粘贴文件，但有时失效，所以可能文件共享可能需要一些别的手段。

##### samba共享文件夹

将共享文件夹挂载至本地电脑，可在文件管理器中直接访问。

##### scp命令

基于ssh的命令行命令，直接将本地某文件上传至服务器中某个位置。

``` 
scp {本地文件} {用户名}@{服务器IP}:{服务器路径}
```

*其 `{用户名}@{服务器IP}` 的表示方式和ssh连接一致*

### 外网

#### 向日葵远程桌面

提供了基于VNC的远程桌面解决方案，需要服务器安装lightdm图形管理器。（**不清楚是否支持多用户**）

1. Linux图形界面安装向日葵远程桌面并在自己的用户下登录
2. 设置无人值守（即无需在服务器上同意即可控制）
3. 本地客户机发起远程控制即可

#### 蒲公英VPN

将异地电脑通过蒲公英VPN提供的公网服务器组成局域网，连接到后可使用前述所有局域网远程登录手段。配合vscode可用于客户机身处外网时的远程调试。

配合手机的ssh客户端也可以使用命令行进行远程搬砖。

1. 通过其他方式在服务器上打开终端（ `ctrl+alt+T` ）
2. 输入命令： `sudo pgyvpn`
3. 首次登录需要输入帐号密码
4. 根据提示，输入 `9` 即 `exit PgyVPN interface` 将pgyvpn转为后台，关闭终端
5. 远程客户机登录同一个pgyvpn帐号，可看到服务器”HPWorkStation“的远程组网IP。相当于在同一个局域网下

*相对于局域网延迟会久一点*

**一个帐号有组网人数限制（免费用户3个）。不清楚是否可以登录多个账户，推测应该是不行**

##### 帐号管理

蒲公英VPN官网提供控制台，提供同一组网下的不同客户机的独立密码设置；对不同用户进行添加/删除等等功能。

## 开发环境

### C++

服务器已预装C++调试有关工具，开箱即用。

#### 命令行调试

简单的跑已经完善的代码收集数据，不需要进行排错的情况下可以使用命令行进行。

make+gdb

//todo

#### vscode+cmake+ssh_remote 本地+远程调试

在本机vscode打开远程工程，支持远程编辑+调试。远程搬砖利器，除了不能显示程序跑出来的图形，写代码/调试体验和本机使用vsocode基本无异。

##### 设置流程

1. 保证服务器安装了 vscode
1. 客户机打开 vscode，点击左侧 Extension 打开扩展栏
2. 搜索并安装 Remote-SSH 扩展
3. 按照提示重启 vscode
4. 点击 vscode 左下的蓝色标志，选择 Remote-SSH: Connect to Host 
5. 输入 `{你的用户名}@{服务器IP}` 即可连接。另外，[ssh免帐号及IP登录](#ssh免帐号及IP登录)中设置的host会显示在这里，如果有的话直接点击就可以连接
6. 新的vscode窗口中左下方显示连接的主机信息即表示连接成功。此时该窗口相当于在服务器上打开的vscode，设置、扩展程序等将与服务器上的设置一致

*设置了ssh免密后远程调试亦免密。*

### python

#### vscode+conda

##### 设置流程

//todo

自然也支持远程调试。

### OFEC特别篇

参见网页￥……%&

## 实用工具

### 系统工具

#### 软件安装

##### apt

包管理器，用过python的pip工具的同学应该有类似的体验。

###### 基本操作：

`apt install {软件名}` 安装某软件

`apt remove {软件名}` 卸载某软件

`apt update` 更新软件列表

`apt upgrade` 更新已安装软件

*需要sudo权限*

###### 更改镜像源

有时下载速度很慢甚至无法下载，可能需要将原始下载路径变更为大陆镜像。

##### snap

另一款包管理器。有很多较新的软件会发布在snap上，apt的良好补充。

###### 基本操作：

安装卸载和 `apt` 无异

`snap refresh` 更新已安装软件（无需先更新软件列表）

#### htop

类似windows进程管理器

###### 基本操作

`htop` 直接进入软件界面，界面下部有基本操作说明。

### git图形工具

git协作时没有图形很难受， git log --graph的输出太简陋且不美观。

#### Sourcetree

图形化界面包含了git的绝大多数操作。

#### vscode git 及有关插件

vscode本身自带git支持，

//todo 

##### GitLens

可显示大量git有关数据（类似于“当前行某人在何时修改过”）。

##### Git Graph

可显示git流图。

### 其他软件 

#### 矢量图绘图工具inkscape

Adobe Illustrator的良好替代。

#### 位图编辑工具GIMP

Adobe Photoshop的良好替代。

## 相关资源及链接

1. linux系统目录结构

https://www.howtogeek.com/117435/htg-explains-the-linux-directory-structure-explained/

2. 一个基于CMake的基本的Linux下的vscode工程样板

https://github.com/monarchBacilluscoli/test_project_vscode_linux

3. 蒲公英VPN

https://pgy.oray.com/download/

4. vscode远程调试官方教程

https://code.visualstudio.com/docs/remote/ssh
