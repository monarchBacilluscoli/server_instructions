# 1. 服务器使用说明

*? 是否更适合使用流程式的说明而非分条的字典式说明*

*本文中可能将包含一些别的工具的使用方法*

下为后面命令行或配置文件中出现的符号及其意义

| 命令中的符号 | 意义                                         |
| ------------ | -------------------------------------------- |
| `{xxx} `     | 代表必要填写的内容                           |
| `[xxx]`      | 代表可选填写的内容                           |
| `~`          | linux下当前用户的home路径的简写              |
| `${xxx}`     | 代表vscode配置中某个系统预设变量（原样填写） |

- [1. 服务器使用说明](#1-服务器使用说明)
  - [1.1. 远程登录](#11-远程登录)
    - [1.1.1. 局域网](#111-局域网)
      - [1.1.1.1. 获取服务器IP](#1111-获取服务器ip)
      - [1.1.1.2. ssh](#1112-ssh)
        - [1.1.1.2.1. 基本操作](#11121-基本操作)
        - [1.1.1.2.2. ssh免密登录](#11122-ssh免密登录)
          - [1.1.1.2.2.1. win10客户机](#111221-win10客户机)
          - [1.1.1.2.2.2. Linux客户机](#111222-linux客户机)
      - [1.1.1.3. ssh免帐号及IP登录](#1113-ssh免帐号及ip登录)
      - [1.1.1.4. 图形远程桌面](#1114-图形远程桌面)
        - [1.1.1.4.1. win10自带远程桌面登录](#11141-win10自带远程桌面登录)
        - [1.1.1.4.2. Linux远程桌面登录](#11142-linux远程桌面登录)
      - [1.1.1.5. 传文件](#1115-传文件)
        - [1.1.1.5.1. Samba共享文件夹](#11151-samba共享文件夹)
        - [1.1.1.5.2. scp命令](#11152-scp命令)
    - [1.1.2. 外网](#112-外网)
      - [1.1.2.1. 向日葵远程桌面](#1121-向日葵远程桌面)
      - [1.1.2.2. 蒲公英VPN](#1122-蒲公英vpn)
        - [1.1.2.2.1. 帐号管理](#11221-帐号管理)
  - [1.2. 开发环境](#12-开发环境)
    - [1.2.1. C++](#121-c)
      - [1.2.1.1. 命令行调试](#1211-命令行调试)
      - [1.2.1.2. vscode+cmake+ssh_remote 本地+远程调试](#1212-vscodecmakessh_remote-本地远程调试)
        - [1.2.1.2.1. 设置流程](#12121-设置流程)
    - [1.2.2. python](#122-python)
      - [1.2.2.1. vscode+conda](#1221-vscodeconda)
        - [1.2.2.1.1. 设置流程](#12211-设置流程)
    - [1.2.3. OFEC特别篇](#123-ofec特别篇)
  - [1.3. 实用工具](#13-实用工具)
    - [1.3.1. 系统工具](#131-系统工具)
      - [1.3.1.1. 命令行下的文本编辑器](#1311-命令行下的文本编辑器)
        - [1.3.1.1.1. nano](#13111-nano)
        - [1.3.1.1.2. vim](#13112-vim)
      - [1.3.1.2. 软件安装](#1312-软件安装)
        - [1.3.1.2.1. apt](#13121-apt)
          - [1.3.1.2.1.1. 基本操作：](#131211-基本操作)
          - [1.3.1.2.1.2. 更改镜像源](#131212-更改镜像源)
        - [1.3.1.2.2. snap](#13122-snap)
          - [1.3.1.2.2.1. 基本操作：](#131221-基本操作)
      - [1.3.1.3. htop](#1313-htop)
          - [1.3.1.3.0.1. 基本操作](#131301-基本操作)
    - [1.3.2. git图形工具](#132-git图形工具)
      - [1.3.2.1. Sourcetree](#1321-sourcetree)
      - [1.3.2.2. vscode git 及有关插件](#1322-vscode-git-及有关插件)
        - [1.3.2.2.1. GitLens](#13221-gitlens)
        - [1.3.2.2.2. Git Graph](#13222-git-graph)
    - [1.3.3. 其他软件](#133-其他软件)
      - [1.3.3.1. 矢量图绘图工具Inkscape](#1331-矢量图绘图工具inkscape)
      - [1.3.3.2. 位图编辑工具GIMP](#1332-位图编辑工具gimp)
      - [1.3.3.3. Linux下运行Windows软件 - Wine](#1333-linux下运行windows软件---wine)
  - [1.4. 经验分享](#14-经验分享)
    - [1.4.1. Linux下命令行运行软件很别扭不知如何下手？](#141-linux下命令行运行软件很别扭不知如何下手)
    - [1.4.2. 关于改动服务器设置](#142-关于改动服务器设置)
  - [1.5. 相关资源及链接](#15-相关资源及链接)

## 1.1. 远程登录

在服务器上直接操作固然爽快无延迟，但不支持多人&跑来跑去很麻烦。何以解忧？远程桌面。  
大体流程如下：

1. 获取服务器IP及帐号信息
2. 选用某种远程桌面软件（命令行/图形）
3. 输入登录信息，登录并使用

### 1.1.1. 局域网

如果你现在身处与服务器同一部交换机之下，可使用局域网进行远程连接。

#### 1.1.1.1. 获取服务器IP

无论使用何种方式进行局域网连接，最开始都需要获取到服务器IP。两种途径：

* 询问别人
* 直接操作服务器：

    1. `ctrl+alt+T` 打开终端

    2. 输入 `ifconfig` 回车

    3. 寻找en开头的项，其中inet即为IP地址，当下是172.24.151.175。

* `ifconfig` 是Unix-like系统的网络接口配置工具，常用于查看IP等设置。其中前缀en代表ethernet，通常是有线局域网，而wl则代表wireless连接，即WIFI。*

#### 1.1.1.2. ssh

ssh提供了命令行下的远程连接，支持多用户多会话，轻量可靠快捷。

##### 1.1.1.2.1. 基本操作

``` 
ssh {服务器上你的用户名}@{服务器IP}
```

然后会询问你用户的密码，输入并回车即可登录。

登录后即可视同本机一般进行命令行操作。

##### 1.1.1.2.2. ssh免密登录

每次都要输入用户名IP密码进行连接非常麻烦，此处提供了免除以上操作的设置方法：

###### 1.1.1.2.2.1. win10客户机

1. powershell中创建公钥：  

打开powershell输入：

``` 
ssh-keygen -t rsa -C "{任意名字或使用邮箱，惯例貌似是邮箱}"
```

*一般默认路径下创建的公钥会存在 `C:/Users/{你的用户名}/.ssh/` 下面，文件名为id_rsa.pub.*

2. 查看公钥并复制内容

``` 
clip < ~/.ssh/id_rsa.pub
```

*将公钥的内容读入剪贴板*

3. 在已经连接到服务器的情况下将复制的内容添加至服务器ssh信任列表中：

命令行下：使用如下命令打开该信任列表

``` 
nano ~/.ssh/authorized_keys
```

粘贴到所有内容的最后即可

图形桌面：直接编辑该文档，粘贴至文件最后即可。

###### 1.1.1.2.2.2. Linux客户机

1. 生成密钥（如 `~/.ssh/rsa.pub` 已经存在则跳过这步）

``` 
ssh-keygen
```

2. 直接使用该命令将公钥复制到服务器

``` 
ssh-copy-id {用户名}@{服务器IP}
```

#### 1.1.1.3. ssh免帐号及IP登录

在 `~/.ssh` 下创建文件名为 `config` 的文件
修改该文件内容为：

``` 
Host HPWorkStation          
  HostName {服务器IP} 
  Port 22
  User {你的用户名}
```

之后即可使用别名（HPWorkStation）登录，即

``` 
ssh HPWorkStation
```

设置了免密的话也无需输入密码

#### 1.1.1.4. 图形远程桌面

很多情况下命令行并不能满足日常的工作需求，我们需要图形界面的连接。Linux提供了多用户远程桌面的支持。

##### 1.1.1.4.1. win10自带远程桌面登录

1. 开始-输入“mstsc”即可打开win10自带远程桌面软件。
2. 输入IP地址，点击连接。遇到提示点击确认。
3. 输入帐号密码，登录即可。

##### 1.1.1.4.2. Linux远程桌面登录

如果用户机是Linux系统，则可以通过Remmina这款软件（Ubuntu自带）进行远程桌面连接。

1. 点击标题栏中的 Add a new connection profile 按钮
2. Server 栏填入服务器IP，Username，Password 填入用户名和密码点击 Connect 即可。

*如果报错your libfreerdp does not support h264，将Color depth改为除默认选项之外的选项即可*

#### 1.1.1.5. 传文件

部分远程桌面软件都支持直接复制粘贴文件，但有时失效，所以可能文件共享可能需要一些别的手段。

##### 1.1.1.5.1. Samba共享文件夹

将服务器文件夹通过Samba共享并挂载至本地电脑，可在文件管理器中直接访问。

1. 编辑samba设置

``` 
sudo nano /etc/samba/smb.conf
```

##### 1.1.1.5.2. scp命令

基于ssh的命令行命令，直接将本地某文件上传至服务器中某个位置。

``` 
scp {本地文件} {用户名}@{服务器IP}:{服务器路径}
```

*其 `{用户名}@{服务器IP}` 的表示方式和ssh连接一致*

### 1.1.2. 外网

#### 1.1.2.1. 向日葵远程桌面

提供了基于VNC的远程桌面解决方案，需要服务器安装lightdm图形管理器。（**不清楚是否支持多用户**）

1. Linux图形界面安装向日葵远程桌面并在自己的用户下登录
2. 设置无人值守（即无需在服务器上同意即可控制）
3. 本地客户机发起远程控制即可

#### 1.1.2.2. 蒲公英VPN

将异地电脑通过蒲公英VPN提供的公网服务器组成局域网，连接到后可使用前述所有局域网远程登录手段。配合vscode可用于客户机身处外网时的远程调试。

配合手机的ssh客户端也可以使用命令行进行远程搬砖。

1. 通过其他方式在服务器上打开终端（ `ctrl+alt+T` ）
2. 输入命令： `sudo pgyvpn`
3. 首次登录需要输入帐号密码
4. 根据提示，输入 `9` 即 `exit PgyVPN interface` 将 `pgyvpn` 转为后台，关闭终端
5. 远程客户机登录同一个pgyvpn帐号，可看到服务器”HPWorkStation“的远程组网IP。相当于在同一个局域网下

*相对于局域网延迟会久一点*

**一个帐号有组网人数限制（免费用户3个）。不清楚是否可以登录多个账户，推测应该是不行**

##### 1.1.2.2.1. 帐号管理

蒲公英VPN官网提供控制台，提供同一组网下的不同客户机的独立密码设置；对不同用户进行添加/删除等等功能。

## 1.2. 开发环境

### 1.2.1. C++

服务器已预装C++调试有关工具（g++，make，以及代码编辑器等），开箱即用。

#### 1.2.1.1. 命令行调试

简单地跑已经完善的代码收集数据，不需要进行排错的情况下可以使用命令行进行。（make+gdb）

//todo

#### 1.2.1.2. vscode+cmake+ssh_remote 本地+远程调试

可在本机 vscode 打开远程工程，支持远程编辑+调试。远程搬砖利器，除了不能显示程序跑出来的图形，写代码/调试体验和本机使用 vsocode 基本无异。

##### 1.2.1.2.1. 设置流程

1. 保证服务器安装了 vscode
1. 客户机打开 vscode，点击左侧 Extension 打开扩展栏
2. 搜索并安装 Remote-SSH 扩展
3. 按照提示重启 vscode
4. 点击 vscode 左下的蓝色标志，选择 Remote-SSH: Connect to Host 
5. 输入 `{你的用户名}@{服务器IP}` 即可连接。另外，[ssh免帐号及IP登录](#ssh免帐号及IP登录)中设置的host会显示在这里，如果有的话直接点击就可以连接
6. 新的vscode窗口中左下方显示连接的主机信息即表示连接成功。此时该窗口相当于在服务器上打开的vscode，设置、扩展程序等将与服务器上的设置一致

*设置了ssh免密后远程调试亦免密。*

CMake在C++开发的时候可以视作是make的高级一层抽象，通过简单的几句CMake命令即可自动生成makefile文件，从而轻松完成工程的编译链接工作。

### 1.2.2. python

#### 1.2.2.1. vscode+conda

##### 1.2.2.1.1. 设置流程

//todo

自然也支持远程调试。

### 1.2.3. OFEC特别篇

参见网页￥……%&

## 1.3. 实用工具

### 1.3.1. 系统工具

#### 1.3.1.1. 命令行下的文本编辑器

##### 1.3.1.1.1. nano

入门级文本编辑器，功能简单上手快，编辑一般配置文件足够，前文中已有用到。

``` 
nano {文件路径}
```

##### 1.3.1.1.2. vim

高级文本编辑器，功能强大，扩展丰富，用于命令行下的代码编辑。对初学者而言操作方式较为拧巴。

``` 
vim {文件路径}
```

#### 1.3.1.2. 软件安装

##### 1.3.1.2.1. apt

包管理器，用过python的pip工具的同学应该有类似的体验。

###### 1.3.1.2.1.1. 基本操作：

`apt install {软件名}` 安装某软件

`apt remove {软件名}` 卸载某软件

`apt update` 更新软件列表

`apt upgrade` 更新已安装软件

*需要 `sudo` 权限*

###### 1.3.1.2.1.2. 更改镜像源

有时下载速度很慢甚至无法下载，可能需要将原始下载路径变更为大陆镜像。

##### 1.3.1.2.2. snap

另一款包管理器。有很多较新的软件会发布在snap上，apt的良好补充。

###### 1.3.1.2.2.1. 基本操作：

安装卸载和 `apt` 无异

`snap refresh` 更新已安装软件（无需先更新软件列表）

#### 1.3.1.3. htop

类似windows进程管理器

###### 1.3.1.3.0.1. 基本操作

`htop` 直接进入软件界面，界面下部有基本操作说明。

### 1.3.2. git图形工具

git协作时没有图形很难受， `git log --graph` 的输出太简陋且不美观。

#### 1.3.2.1. Sourcetree

图形化界面包含了git的绝大多数操作。

#### 1.3.2.2. vscode git 及有关插件

vscode本身自带git支持，包含了最最基本的功能如对比提交，处理合并冲突，stage，commit等。但有一些更方便的功能需要别的插件的支持：

##### 1.3.2.2.1. GitLens

可显示大量git有关数据（类似于“当前行某人在何时修改过”）。

##### 1.3.2.2.2. Git Graph

可显示git流图。傻瓜插件，安装即会用。

### 1.3.3. 其他软件 

#### 1.3.3.1. 矢量图绘图工具Inkscape

Adobe Illustrator的良好替代。

#### 1.3.3.2. 位图编辑工具GIMP

Adobe Photoshop的良好替代。

#### 1.3.3.3. Linux下运行Windows软件 - Wine

很强，实测可以运行StarCraft II及一系列Windows下的游戏。以及Matlab，PS等实用软件。如果想使用Linux或者Mac OS进行日常工作同时使用某些Windows平台上的软件，可以考虑Wine。

不过具体使用之前需要在官网上查看支持信息以及安装对应版本的Wine -- 它并不是越新越好。

## 1.4. 经验分享

### 1.4.1. Linux下命令行运行软件很别扭不知如何下手？

首先，一般运行命令大抵依如下格式：

``` 
{命令} [选项] [参数] ...
```

以常用的 `ls` 命令为例：

``` 
ls -l /etc
```

* `ls` 即为列出指定路径下文件及文件夹的命令
* `-l` 是一个选项，表明文件信息将以详细列表格式（long listing format）显示，如不设定 `-l` ，则文件将仅显示文件名
* `/etc` 即为该命令的执行对象（参数），为Linux下储存各种配置的路径 `/etc` .

整个命令的含义即为以详细列表格式显示 `/etc` 下的所有文件及文件夹

其次，在了解调用形式之后，当我们**知道我们要使用的命令名但不知道具体用法（比如不说的话没人知道ls有 `-l` 、 `-A` 等一系列选项）怎么办**？

1. 搜索引擎
2. 输入 `{命令名} --help` 即可显示该命令用法（一个单词的命令行参数一般以两个“ `-` ”开头）

> 常用 `--help` ，万事不求人。

### 1.4.2. 关于改动服务器设置

当你在服务器上碰到了什么问题之后进行了搜索，然后获得了一个看起来不错的解决方案。其中需要使用 `sudo` 修改一些文件，而这些文件的路径可能在 `/etc` 等，并非 `/home` 路径时，请优先考虑和懂行的师兄师姐沟通。最起码记得你都干了些啥。

> 随意改动系统级配置可能会导致五花八门的后果。

## 1.5. 相关资源及链接

1. linux系统目录结构

https://www.howtogeek.com/117435/htg-explains-the-linux-directory-structure-explained/

2. 一个基于CMake的基本的Linux下的vscode工程样板

https://github.com/monarchBacilluscoli/test_project_vscode_linux

5. CMake入门好文

https://www.hahack.com/codes/cmake/

3. 蒲公英VPN

https://pgy.oray.com/download/

4. vscode远程调试官方教程

https://code.visualstudio.com/docs/remote/ssh

6. Samba教程

https://ubuntu.com/tutorials/install-and-configure-samba#3-setting-up-samba

7. git教程

https://www.liaoxuefeng.com/wiki/896043488029600
